#### Anthos:
#### Modified from https://github.com/detlearsom/DetGen/tree/main
Log capture method: Rsyslog
Log redirection method: Logger through capture script. 

Note: Syncthing has no default logging file https://forum.syncthing.net/t/how-to-logging/215. Current solution redirects stdout and stderr to a file, then logger is called through capture script.

Usage: use instructions below to set the configuration automatically, then:
    sudo ./capture_syncthing.sh ACTIVITY DURATION REPEAT 

## INSTRUCTIONS: 

Two clients running the file synchronizer [syncthing](https://syncthing.net/).

Uses the [Linuxserver container](https://hub.docker.com/r/linuxserver/syncthing/) pinned to
version 129 (10th Aug 2018).

### Do this only for the first time you run the containers. Use same methodology if using 3 containers

1. Clean previous install:

	rm -rf client1/conf
    rm -rf client2/conf

2. Bring up containers (run `../capture.sh 600` to give some time to setup+capture).
   
3. Then visit two containers in a web browser on the host, the two instances:

    http://localhost:3384
    http://localhost:3385

4. Refuse the "Allow anonymous usage reporting" dialog in both instances

5. In first window, Actions -> Show ID, note long string.

6. In second window, Remote Devices -> Add Remote Device, choose the nearby device

    * confirm it is string seen in first window (almost certainly)

7. After some time, the first container will advise that the second wants to connect.
    * confirm
    * now the devices should see each other under "Remote Devices"
    * (one shows an ID, the other shows a random docker hostname)

8. Now edit the Default Folder on first container and select share with the second device.

9. After some time, in the second container the shared folder will be advertised.  Accept.

10. Now both `Default Folder` instances should show "Up to Date" in green.

11. Briefly test sharing by entering into terminal: 

    `date > client1/conf/Sync/foo.txt`

12. Verify that foo.txt is copied over to `client2/conf/Sync`.

13. The next time you do not need to rm -rf client1/conf and client2/conf. Only their Sync folders, e.g. `rm -rf client1/conf/Sync`. This is automated in the scripts


### SCRIPTS and scenarios
To run a script, just run `../capture.sh TIME` as usual. After the containers have been set up you can run any of the python scripts (1-5). There are 6 scenarios. NOTE: sometimes 70 seconds is not enough for syncthing to transfer the file so try a couple of times.
1. No file transfer/editing. Just listening on to the traffic generated by syncthing. No need to run any script.
2. Put a single text file. `script1.py`
3. Put a single text file and then edit it. `script2.py`
4. Put a single text file and then delete it. `script3.py`
5. Put a single text file, edit it and then delete it. `script4.py`
6. Put a 2MB video file. `script5.py`

The scripts can be found in scripts_2 (for the case when running a 2-container version) and in scripts_3.
